-- Создание базы данных и таблицы
CREATE DATABASE Магазин;
USE Магазин;

CREATE TABLE Товары (
    Идентификатор INT PRIMARY KEY AUTO_INCREMENT,
    Название VARCHAR(255),
    Цена DECIMAL(10, 2),
    КоличествоНаСкладе INT
);

-- Добавление начальной записи в СпецТаблица
CREATE TABLE СпецТаблица (
    Идентификатор INT PRIMARY KEY,
    ИмяТаблицы VARCHAR(255) NOT NULL,
    ИмяСтолбца VARCHAR(255) NOT NULL,
    ТекущееМаксимальноеЗначение INT NOT NULL
);

INSERT INTO СпецТаблица (Идентификатор, ИмяТаблицы, ИмяСтолбца, ТекущееМаксимальноеЗначение)
VALUES (1, 'СпецТаблица', 'Идентификатор', 1);

-- Вызов процедуры для таблицы "Товары"
CALL ПолучитьСледующееЗначение('Товары', 'Идентификатор', @СледующееЗначение);
SELECT @СледующееЗначение; -- Ожидается 1

-- Проверка содержимого "СпецТаблица"
SELECT * FROM СпецТаблица;

-- Добавление новой записи в таблицу "Товары" без использования процедуры
INSERT INTO Товары (Идентификатор, Название, Цена, КоличествоНаСкладе)
VALUES (5, 'Тестовый Товар', 1000.00, 10);

-- Проверка автоматического обновления "СпецТаблица"
SELECT * FROM СпецТаблица;
-- Обновление идентификатора товара вручную
UPDATE Товары SET Идентификатор = 10 WHERE Идентификатор = 5;

-- Проверка автоматического обновления "СпецТаблица" после изменения
SELECT * FROM СпецТаблица;

-- Добавление новой записи через ХП
CALL ПолучитьСледующееЗначение('Товары', 'Идентификатор', @СледующееЗначение);
SELECT @СледующееЗначение; -- Ожидается 11

-- Проверка содержимого таблиц
SELECT * FROM Товары;
SELECT * FROM СпецТаблица;

-- Удаление тестовых данных
DROP TABLE Товары;
DROP TABLE СпецТаблица;
DROP PROCEDURE ПолучитьСледующееЗначение;
